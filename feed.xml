<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="http://jekyllrb.com" version="3.4.0">Jekyll</generator><link href="https://jbleijenberg.github.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://jbleijenberg.github.io/" rel="alternate" type="text/html" /><updated>2017-10-12T10:07:13+02:00</updated><id>https://jbleijenberg.github.io/</id><title type="html">Jeroen Bleijenberg</title><subtitle>Jeroen Bleijenberg's personal page and contact information</subtitle><entry><title type="html">Recompile GD module for PHP 5.6.x</title><link href="https://jbleijenberg.github.io/recompile-gd-module-for-php-56x/" rel="alternate" type="text/html" title="Recompile GD module for PHP 5.6.x" /><published>2017-10-12T00:00:00+02:00</published><updated>2017-10-12T00:00:00+02:00</updated><id>https://jbleijenberg.github.io/recompile-gd-module-for-php-56x</id><content type="html" xml:base="https://jbleijenberg.github.io/recompile-gd-module-for-php-56x/">&lt;p&gt;When using PHP5.6 with the GD module enabled, you can miss out on some GD function when PHP itself isn&amp;#39;t compiled with GD support enabled.
Errors like this may pop up in your php_error.log&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;PHP Fatal error:  Call to undefined function imageantialias() in ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If we test this via the command line, we can see that it&amp;#39;s true (why shouldn&amp;#39;t it be?):&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ php -r &quot;var_dump(function_exists('imageantialias'));&quot;
bool(false)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Recompiling PHP is a way to go, but could bring some unexpected issues if you don&amp;#39;t know what you&amp;#39;re doing.
Another option is to rebuild the GD module.&lt;/p&gt;

&lt;p&gt;In order for this to work, i had to install some packages. This might not be the case for you.
The packages i needed to install before recompiling were:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;php-devel&lt;/li&gt;
&lt;li&gt;libjpeg-turbo-devel&lt;/li&gt;
&lt;li&gt;libpng-devel&lt;/li&gt;
&lt;li&gt;libxml2-devel&lt;/li&gt;
&lt;li&gt;libXpm-devel&lt;/li&gt;
&lt;li&gt;freetype-devel&lt;/li&gt;
&lt;li&gt;gcc-devel&lt;/li&gt;
&lt;li&gt;t1lib-devel&lt;/li&gt;
&lt;li&gt;libvpx&lt;/li&gt;
&lt;li&gt;libtool&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Next, download your version of the PHP source and move to the GD extension directory.
For me, this was PHP 5.6.31&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ cd /tmp
$ wget http://cz2.php.net/get/php-5.6.31.tar.gz/from/this/mirror -O php-5.6.31.tar.gz
$ tar -xvf php-5.6.31.tar.gz
$ cd php-5.6.31/ext/gd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Prepare the extension&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ phpize
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Configure the extension&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ ./configure --with-php-config=/usr/bin/php-config --with-freetype-dir=&amp;lt;YOUR_VALUE&amp;gt; --with-jpeg-dir=&amp;lt;YOUR_VALUE&amp;gt; --with-xpm-dir=&amp;lt;YOUR_VALUE&amp;gt; --with-vpx-dir=&amp;lt;YOUR_VALUE&amp;gt; --with-t1lib
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can find the values you need with &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ php-config --configure-options
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After the configuration is done, run make&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ make
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After Make is done, you should see output similar like this:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;----------------------------------------------------------------------
Libraries have been installed in:
   /tmp/php-5.6.31/ext/gd/modules

If you ever happen to want to link against installed libraries
in a given directory, LIBDIR, you must either use libtool, and
specify the full pathname of the library, or use the `-LLIBDIR'
flag during linking and do at least one of the following:
   - add LIBDIR to the `LD_LIBRARY_PATH' environment variable
     during execution
   - add LIBDIR to the `LD_RUN_PATH' environment variable
     during linking
   - use the `-Wl,-rpath -Wl,LIBDIR' linker flag
   - have your system administrator add LIBDIR to `/etc/ld.so.conf'

See any operating system documentation about shared libraries for
more information, such as the ld(1) and ld.so(8) manual pages.
----------------------------------------------------------------------
Installing shared extensions:     /usr/lib64/php/modules/
Installing header files:           /usr/include/php/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Copy the gd.so file from the modules dir, to the modules dir of your PHP installation.
You need to overwrite the gd.so file that already is present.
In this case that was &lt;em&gt;/usr/lib64/php/modules/&lt;/em&gt;  as was told by the output above.&lt;/p&gt;

&lt;p&gt;Restart Apache, and verify that the new GD module is working.
Check &lt;code&gt;phpinfo();&lt;/code&gt; to see if the module is there and check your error logs to see if PHP isn&amp;#39;t having trouble with your new GD extension.&lt;/p&gt;

&lt;p&gt;If that&amp;#39;s all good, &lt;code&gt;function_exists()&lt;/code&gt; should return &lt;code&gt;true&lt;/code&gt; now:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ php -r &quot;var_dump(function_exists('imageantialias'));&quot;
bool(true)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><author><name></name></author><summary type="html">When using PHP5.6 with the GD module enabled, you can miss out on some GD function when PHP itself isn&amp;#39;t compiled with GD support enabled. Errors like this may pop up in your php_error.log</summary></entry><entry><title type="html">Satis and S3</title><link href="https://jbleijenberg.github.io/satis-and-s3/" rel="alternate" type="text/html" title="Satis and S3" /><published>2017-03-23T03:23:00+01:00</published><updated>2017-03-23T03:23:00+01:00</updated><id>https://jbleijenberg.github.io/satis-and-s3</id><content type="html" xml:base="https://jbleijenberg.github.io/satis-and-s3/">&lt;h2&gt;Satis and AWS S3&lt;/h2&gt;

&lt;p&gt;Satis is a static composer repository generator. It does nothing more than creating an index of your packages, from the repositories you added in your Satis configuration.&lt;/p&gt;

&lt;p&gt;It&amp;#39;s alse possible to use Satis as a proxy for packages found on Packagist, GitHub or any other repository.&lt;/p&gt;

&lt;p&gt;When we started with Satis, we hosted it on a small server which required Apache to serve satis.&lt;/p&gt;

&lt;p&gt;Because the number of packages and repositories grew as we started to work on bigger and more projects, we ran into the &amp;quot;limitations&amp;quot; of hosting Satis on a webserver.&lt;/p&gt;

&lt;p&gt;These weren&amp;#39;t really limitations, but we figured that using a webserver was actually overkill because Satis is nothing more than static content.&lt;/p&gt;

&lt;p&gt;This is where AWS S3 came in the picture. S3 is perfect for serving static content without the need of a webserver. A big advantage is that you don&amp;#39;t pay a lot for storage,or traffic. And when first registering an AWS account, you are eligable for the free tier. (See: https://aws.amazon.com/s3/pricing/)&lt;/p&gt;

&lt;p&gt;So no more worries for large Satis configurations!&lt;/p&gt;

&lt;h3&gt;So how did we do this&lt;/h3&gt;

&lt;p&gt;Actually, very little changed in the way we generate our Satis files. Our satis configuration has its own repository, so our developers can add new repositories when needed. Whenever a pull request is merged into our mainline, our build agents picks up on this change. And starts to build Satis. Nothing exiting is going on there.&lt;/p&gt;

&lt;p&gt;We remove our existing Satis build and create a new one. &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ rm -rf web/include/* satis build -n -vvv satis.json web/ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This process might take a while of you have a lot of repositories. Depending on your Satis configuration, all package version might be downloaded. This is preferred by us, because not all projects have to (or can) use the latest version of a package. And since S3 is pretty limitless when it comes to storage, we&amp;#39;ll just download everything.&lt;/p&gt;

&lt;p&gt;The configuration that makes sure we want to use Satis as a proxy is as follows:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plain&quot; data-lang=&quot;plain&quot;&gt;{
    &quot;require-all&quot;: true,
    &quot;archive&quot;: {
        &quot;directory&quot;: &quot;dist&quot;,
        &quot;format&quot;: &quot;tar&quot;,
        &quot;skip-dev&quot;: true,
        &quot;whitelist&quot;: [
            &quot;&amp;lt;manufacturer&amp;gt;/&amp;lt;package&amp;gt;&quot;,
        ]
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The whitelist flag is optional. When left out, every package, version and dependancy is archived. It&amp;#39;s up to you do decide what you want to proxy. Creating projects with as many packages from your proxy speeds up the &lt;code&gt;composer install&lt;/code&gt; precess quite a bit, because composer doesn&amp;#39;t hae to clone every repository.&lt;/p&gt;

&lt;p&gt;After the Satis build is done, we want to upload/sync everything inside &amp;#39;web/&amp;#39; to S3.&lt;/p&gt;

&lt;p&gt;Our build agent has the AWS CLI binary installed, so this is pretty easy:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ aws s3 sync --delete . s3://&amp;lt;your-pretty-bucket&amp;gt;/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will sync your Satis build to S3, and will remove any packages that are no longer present within Satis.&lt;/p&gt;

&lt;p&gt;That&amp;#39;s it. Now your satis build is usable from AWS S3.&lt;/p&gt;

&lt;h3&gt;Wait, i don&amp;#39;t have an S3 bucket yet.&lt;/h3&gt;

&lt;p&gt;Well, creating an S3 bucket is free. If you don&amp;#39;t have an AWS account yet, please make one.&lt;/p&gt;

&lt;p&gt;When you have an AWS account, you can create a S3 bucket. Choose a name that you can recognize, and choose a region that is close to you. For us Dutchies, Frankfurt or Ireland will be just fine.&lt;/p&gt;

&lt;p&gt;When choosing a name, add your company name as prefix/suffix so the name is somewhat unique. The name needs to be unique in the entire region you choose, not just in your account.&lt;/p&gt;

&lt;p&gt;In the next step, we can disable versioning and logging (we simply just don&amp;#39;t care). Adding tags is up to you.&lt;/p&gt;

&lt;p&gt;For public permission it&amp;#39;s easier to read permissions to anyone. If you set this to any authenticated user, everyone who wants to run composer install needs an AWS account.&lt;/p&gt;

&lt;p&gt;After this, finalize your bucket. It will appear in your bucketlist (pun intended) and click on the name to edit it.&lt;/p&gt;

&lt;p&gt;In the tab &amp;#39;Properties&amp;#39;, go to Static website hosting and select &amp;#39;Use this bucket to host a website&amp;#39;.&lt;/p&gt;

&lt;p&gt;Now you have an S3 bucket, ready for your Satis build!&lt;/p&gt;

&lt;h3&gt;But my repo url is so ugly&lt;/h3&gt;

&lt;p&gt;Your bucket is usable for static website hosting, but your endpoint probably looks something like this:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;http://your-pretty-bucket.s3-website-eu-west-1.amazonaws.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can simply add a CNAME record to your DNS configuration, to make your S3 a bit easier to access.&lt;/p&gt;

&lt;p&gt;But since a while Composer somewhat forces you to use an repository with secure access, unless you&amp;#39;ve added a flag to ignore this.&lt;/p&gt;

&lt;p&gt;When you want to use SSL with your S3 bucket, you will need to configure CloudFront. We will need a Web distribution for this. I&amp;#39;m assuming you have some knowledge of AWS&amp;#39; services so will not explain what everything means in the CloudFront console.&lt;/p&gt;

&lt;h3&gt;The SSL certificate.&lt;/h3&gt;

&lt;p&gt;Unfortunatly CloudFront doesn&amp;#39;t support 4096-bit certificates, but for this purpose 2048-bit is fine too. It&amp;#39;s up to you where you purchase your certificate. You can import your certificate in AWS&amp;#39; ACM (AWS Certificate Manager).&lt;/p&gt;

&lt;h3&gt;Creating a CloudFront distribution&lt;/h3&gt;

&lt;p&gt;At &amp;#39;Origin Domain Name&amp;#39; choose your Satis bucket, you&amp;#39;ve created in the steps before. Set &amp;#39;Viewer Protocol Policy&amp;#39; to &amp;#39;Redirect HTTP to HTTPS&amp;#39; The &amp;#39;Allowed HTTP Methods&amp;#39; can be set to &amp;#39;GET, HEAD, OPTIONS, PUT, POST, PATCH, DELETE&amp;#39;&lt;/p&gt;

&lt;p&gt;For &amp;#39;Object Caching&amp;#39; we can use Origin Cache Headers. Set &amp;#39;Query String Forwarding and Caching&amp;#39; to none, for better caching.&lt;/p&gt;

&lt;p&gt;Select the priceclass that&amp;#39;s best suited for you, but &amp;#39;Use Only US, Canada and Europe&amp;#39; is probably fine.&lt;/p&gt;

&lt;p&gt;Select &amp;#39;Custom SSL Certificate (example.com)&amp;#39; and choose the certificate you just uploaded in ACM.&lt;/p&gt;

&lt;p&gt;!!! Make sure that you select &amp;#39;Only Clients that Support Server Name Indication(SNI)&amp;#39;, or else this distrubition is going to cost you about $600,- every month !!!&lt;/p&gt;

&lt;p&gt;Supported HTTP versions can bet set to &amp;#39;HTTP/1.1, HTTP/1.0 For the default root object, we need to fill in &amp;#39;index.html&amp;#39;&lt;/p&gt;

&lt;p&gt;Using IPv6 is up to you, no extra charge.&lt;/p&gt;

&lt;p&gt;And that&amp;#39;s it for CloudFront. After your destribution is deployed, you can access with a secure connection. Don&amp;#39;t forget to add the CNAME records to your DNS configuration.&lt;/p&gt;</content><author><name></name></author><summary type="html">Satis and AWS S3 Satis is a static composer repository generator. It does nothing more than creating an index of your packages, from the repositories you added in your Satis configuration.</summary></entry></feed>